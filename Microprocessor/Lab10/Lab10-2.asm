	ORG 0000H
	AJMP MAIN
	ORG 0BH
	AJMP TIMER
	ORG 0050H
MAIN:
	MOV P0,#0H
	MOV TMOD,#00000001B
	MOV TH0,#0F1H
	MOV TL0,#18H
	SETB ET0
	CLR TF0
	SETB EA
	SETB TR0			
	
START:
	ROW1:
	MOV P1,#7FH		
	CALL DELAY
	MOV A,P1
	ANL A,#0FH          
	MOV R5,#0
	CJNE A,#0FH,COL1  
ROW2:				
	MOV P1,#0BFH
	CALL DELAY
	MOV A,P1
	ANL A,#0FH
	MOV R5,#12
	CJNE A,#0FH,COL1 
ROW3:				  	
	MOV P1,#0DFH		
	CALL DELAY
	MOV A,P1
	ANL A,#0FH
	MOV R5,#24
	CJNE A,#0FH,COL1 
ROW4:				 	
	MOV P1,#0EFH
	CALL DELAY
	MOV A,P1
	ANL A,#0FH	
	MOV R5,#36
	CJNE A,#0FH,COL1  
	JMP ROW1 		  
COL1:
	CJNE A,#0EH,COL2	
	MOV R4,#0			 
	JMP SHOW
COL2:
	CJNE A,#0DH,COL3	
	MOV R4,#3			
	JMP SHOW
COL3:
	CJNE A,#0BH,COL4	 
	MOV R4,#6		
	JMP SHOW
COL4:
	CJNE A,#07H,ROW1	
	MOV R4,#9		
SHOW:
	SETB TR0;
	MOV A,R5
	ADD A,R4
	MOV R3,A 			
SOUND:	
	MOV DPTR,#TABLE  
	MOV A,R3
	MOVC A,@A+DPTR
	MOV R0,A;		
	INC R3;

	MOV A,R3
	MOVC A,@A+DPTR
	MOV R1,A;		
	INC R3;

	MOV A,R3
	MOVC A,@A+DPTR
	MOV R2,A
	INC R3
	
	ACALL LOOP

	CLR TR0
	JMP START;
LOOP:
	CJNE R2,#0H,LOOP 
	RET;	
TIMER:
	CPL P0.0
	MOV TH0,R0
	MOV TL0,R1
	DEC R2		
	RETI
TABLE:					;timer時間 high 8bit;timer時間 low 8bit;震盪次數
	DB	0F1H,018H,131
	DB  0F2H,070H,144
	DB	0F2H,0B7H,147
	DB	0F3H,0DFH,161
	DB	0F4H,02AH,165
	DB	0F4H,0D7H,175
	DB  0F5H,72H,185
	DB	0F6H,09H,196
	DB  0F6H,9DH,208
	DB	0F7H,20H,220
	DB  0F7H,9FH,233
	DB	0F8H,18H,247
DELAY:		
	MOV R6,#80
DELAY2:
	MOV R7,#100
DELAY3:
	DJNZ R7,DELAY3
	DJNZ R6,DELAY2
	RET

	END
