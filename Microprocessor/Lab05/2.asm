	ORG		0000H
	JMP		START
	ORG		0050H
START:
	MOV		R0,#0		//歸零
	MOV		R1,#0
	MOV		R2,#255
	MOV		R3,#0
	MOV		R4,#0
	MOV		R5,#0
	MOV		R6,#0
MAIN:
	DJNZ	R2,ROW1	   //開始計算讀取次數
	MOV		R2,#255	   //將B重設回255
ROW1:
	MOV		P0,#01111111B		//看第一row	
	CALL	DELAY				//Delay消除彈跳
	MOV		A,P0				
	ANL		A,#00001111B		//看有無被按下 	
	MOV		R1,#0				//一行差4 4*0
	CJNE	A,#00001111B,COL1	//如果A不等於00001111B，表示有col按下	
ROW2:
	MOV		P0,#10111111B
	CALL	DELAY
	MOV		A,P0
	ANL		A,#00001111B
	MOV		R1,#4				//一行差4	4*1
	CJNE	A,#00001111B,COL1	
ROW3:
	MOV		P0,#11011111B 
	CALL	DELAY
	MOV		A,P0
	ANL		A,#00001111B
	MOV		R1,#8				//一行差4 4*2
	CJNE	A,#00001111B,COL1 
ROW4:
	MOV		P0,#11101111B 	
	CALL	DELAY
	MOV		A,P0
	ANL		A,#00001111B
	MOV		R1,#12				//一行差4 4*3
	CJNE	A,#00001111B,COL1
	JMP		MAINTAIN
COL1:
	CJNE	A,#00001110B,COL2	
	MOV		R0,#0	//0
	JMP		SHOW
COL2:
	CJNE	A,#00001101B,COL3 
	MOV		R0,#1	//1
	JMP		SHOW
COL3:
	CJNE	A,#00001011B,COL4 
	MOV		R0,#2	//2
	JMP		SHOW
COL4:
	CJNE	A,#00000111B,MAINTAIN	//沒有數字被按下 不更新R1也不更新R0	
	MOV		R0,#3 	//3
SHOW:
	MOV		A,R2	   	//查看B是不是到255
	SUBB	A,#255
	JNC		CHECK	//相減沒借位表示有255跳到更新數字	
MAINTAIN:			//維持原本的顯示
	MOV		A,R6
	MOV		DPTR,#TABLE4
	MOVC	A,@A+DPTR
	MOV		P1,A 			
	CALL	DELAY

	MOV		A,R5
	MOV		DPTR,#TABLE3
	MOVC	A,@A+DPTR
	MOV		P1,A 			
	CALL	DELAY

	MOV		A,R4
	MOV		DPTR,#TABLE2
	MOVC	A,@A+DPTR
	MOV		P1,A 			
	CALL	DELAY

	MOV		A,R3
	MOV		DPTR,#TABLE1
	MOVC	A,@A+DPTR
	MOV		P1,A 			
	CALL	DELAY
	JMP		MAIN
CHECK:			   	//查看新的數字是不是十位數
	MOV		A,R1
	ADD		A,R0			
	SUBB 	A,#10
	JC		MOVONCE
MOVTWICE:			//十位數移動兩次
	MOV		A,R4
	MOV		R6,A
	MOV		A,R3
	MOV		R5,A
	CLR		A
	MOV		R4,A 
	INC		R4
	MOV		A,R1
	ADD		A,R0
	SUBB 	A,#10
	MOV		R3,A
	JMP		MAIN
MOVONCE:		   	//個位數移動一次
	MOV		A,R5
	MOV		R6,A
	MOV		A,R4
	MOV		R5,A
	MOV		A,R3
	MOV		R4,A
	MOV		A,R1
	ADD		A,R0
	MOV		R3,A
	JMP		MAIN
;--------------------------
DELAY:
	MOV		R7,#255
DELAY1:
	DJNZ	R7,DELAY1
	RET
;--------------------------
TABLE1:
	DB		01110000B	
	DB		01110001B	 
	DB		01110010B	 	
	DB		01110011B 	
	DB		01110100B	
	DB		01110101B	
	DB		01110110B	
	DB		01110111B	
	DB		01111000B	
	DB		01111001B
TABLE2:
	DB		10110000B	  
	DB		10110001B	
	DB		10110010B	
	DB		10110011B 	 
	DB		10110100B	 
	DB		10110101B	
	DB		10110110B	
	DB		10110111B	
	DB		10111000B	
	DB		10111001B
TABLE3:
	DB		11010000B	
	DB		11010001B	 
	DB		11010010B	
	DB		11010011B 	 
	DB		11010100B	
	DB		11010101B	
	DB		11010110B	
	DB		11010111B	
	DB		11011000B	
	DB		11011001B
TABLE4:
	DB		11100000B	 
	DB		11100001B	 
	DB		11100010B	 	
	DB		11100011B 	 
	DB		11100100B	 
	DB		11100101B	
	DB		11100110B	
	DB		11100111B	
	DB		11101000B	
	DB		11101001B
	END