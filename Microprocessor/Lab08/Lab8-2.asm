	ORG 0000H
	JMP START
	ORG 0050H

START:
	MOV	R0,#10000000B
	MOV	R5,#0
	CALL	DELAY
	CALL	DELAY
	MOV	A,#00111011B	;初始設定，2列、5*7、8位元存取
	CALL	COMMAND		;把A送到instruction register   	
	MOV	A,#00001110B	;Display ON,Cursor ON,Blink OFF	  	
	CALL	COMMAND
	MOV	A,#00000110B	;設定寫資料進入LCD時, 顯示器不要動, 游標向右移一格
	CALL	COMMAND
	MOV	A,#00000001B	;清除全螢幕
	CALL	COMMAND
	MOV	R5,#0			;延遲等清除LCD命令處理完畢
	CALL	DELAY
	CALL	DELAY
	MOV	A,#01000000B	;設定CG RAM位址
	CALL	COMMAND
	CALL	SETFONT
	MOV	A,#10000000B	;設定DD RAM位址=0
	CALL	COMMAND

LOOP:	
	MOV	A,#00000000B	;顯示第一個字	
	CALL	SENDDATA
	MOV	R5,#100
	CALL	DDELAY
	MOV	A,#00000001B	;清除LCD	
	CALL	COMMAND
	MOV	R5,#10		
	CALL	DDELAY
	MOV	A,R0			;游標移到第一行開頭		
	CALL	COMMAND
	MOV	A,#00000001B	;顯示第二個字 	
	CALL	SENDDATA
	MOV	R5,#100
	CALL	DDELAY
	MOV	A,#00000001B	;清除LCD	
	CALL	COMMAND
	MOV	R5,#10		
	CALL	DDELAY
	MOV	A,R0			;游標移到第一行開頭		
	CALL	COMMAND
	MOV	A,#00000010B	;顯示第三個字	
	CALL	SENDDATA
	MOV	R5,#100
	CALL	DDELAY
	MOV	A,#00000001B	;清除LCD	
	CALL	COMMAND
	JMP	LOOP
COMMAND:
	MOV	P1,#00000100B
	MOV	P0,A
	MOV	R7,#50			;延遲等訊號穩定	
	DJNZ	R7,$
	MOV	P1,#00000000B	;關掉溝通	
	MOV	R7,#60			;延遲等訊號處裡完畢	
	DJNZ	R7,$
	RET
SENDDATA:
	MOV	P1,#00000101B
	MOV	P0,A
	MOV	R7,#50			;延遲等訊號穩定	
	DJNZ	R7,$
	CLR	P1.2			;讓Enable接腳產生負緣訊號
	MOV	R7,#250			;延遲等訊號處裡完畢	
	DJNZ	R7,$
	RET
SETFONT:				;造字副程式
		MOV	DPTR,#FONT	;指標指到字型表開頭		
		MOV	R6,#8*3		;一個字8筆資料, n個字共 8 x n 筆資料	
NEXT:		
		CLR	A			;清除累加器內資料
		MOVC	A,@A+DPTR	;讀取字型資料
		CALL	SENDDATA
		INC	DPTR		;指標內容加1, 指到下一行字型
		DJNZ	R6,NEXT
		RET
		
FONT:			
		DB	00100B		;第一個字的5x7字型
		DB	01010B
		DB	00100B
		DB	11111B
		DB	10101B
		DB	00100B
		DB	01010B
		DB	00000B

		DB	00100B		;第二個字的5x7字型
		DB	01010B
		DB	10100B
		DB	11111B
		DB	00101B
		DB	00100B
		DB	01010B
		DB	00000B

		DB	00100B		;第三個字的5x7字型
		DB	01010B
		DB	00101B
		DB	11111B
		DB	10100B
		DB	00100B
		DB	01010B
		DB	00000B	
DDELAY:			  		;長延遲
	MOV	R6,#100
DDELAY1:
	MOV	R7,#100
DDELAY2:
	DJNZ	R7,DDELAY2	
	DJNZ	R6,DDELAY1
	DJNZ	R5,DDELAY
	RET
DELAY:					 ;短延遲
	MOV	R6,#2
DELAY1:
	MOV	R7,#5
DELAY2:
	DJNZ	R7,DELAY2	
	DJNZ	R6,DELAY1
	DJNZ	R5,DELAY
	RET
	END
	