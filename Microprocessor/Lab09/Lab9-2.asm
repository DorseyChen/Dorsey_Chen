	ORG	00H
	JMP	INITIAL
	ORG	03H
	JMP	INTERRUPT
INITIAL:
	SETB	IT0                ;外部中斷P3.2設為edge trigger  	
	MOV		IE,#10000001B  	   ;interrupt enable EA=1,EX0=1	  	
	MOV		R1,#0               
	MOV		R4,#0
WAIT:
	JMP		WAIT                 ;一個無限循環的空loop  	
INTERRUPT:
	CALL	TABL
NEXT:
	MOV		R0,#72	    
	MOV		R3,#24            	;顯示24次
NEXT_COLUMN:                    ;一次顯示3*8bit的燈 	
	CALL	READ_BYTE		
	MOV		P1,A
	CALL	READ_BYTE
	MOV		P2,A
	CALL	READ_BYTE
	MOV		P0,A
	CALL	DELAY             ;短暫的delay視覺暫留		
	DJNZ	R3,NEXT_COLUMN
	CJNE 	R4,#50,COUNT       ;如果全部顯示完則歸零			    
	INC		R1
	MOV		R4,#0
	RETI
COUNT:
	INC		R4
	RETI	
READ_BYTE:
	DEC		R0                    ;讀取table用
	MOV		A,R0			
	MOVC	A,@A+DPTR
	CPL		A
	RET
TABL:
	CJNE	R1,#0,J1
	MOV		DPTR,#TABLE0
	RET	
J1:
	CJNE	R1,#10,J2          ;如果中斷次數＝10次
	MOV	DPTR,#TABLE1    
	RET
J2:
	CJNE	R1,#15,J3          ;邏輯同上	
	MOV	DPTR,#TABLE2   
	RET
J3:
	CJNE	R1,#20,J4          ;邏輯同上	
	MOV	DPTR,#TABLE3
	RET
J4:
	CJNE	R1,#25,J5          ;邏輯同上	
	MOV	DPTR,#TABLE4
	RET
J5:
	MOV		R1,#0        ;邏輯同上	
	MOV	DPTR,#TABLE0     
	RET

TABLE0:
		DB      0000000B,00000000B,00000000B
        DB      0000001B,11111111B,11100000B
        DB      0000111B,11111111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001111B,00000000B,00111100B
        DB      0001100B,00000000B,00001100B
        DB      0001100B,00000000B,00001100B
        DB      0001111B,10000000B,01111100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111111B,11111000B
        DB      0000000B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE1:
        DB      0000001B,11111100B,01100000B
		DB      0000111B,11111110B,01111000B
		DB      0001111B,11111111B,00001100B
		DB      0001111B,00000111B,00001100B
		DB      0001100B,00000011B,00001110B
		DB      0001100B,00000011B,00001110B
		DB      0001100B,00000011B,00001110B
		DB      0001110B,00000111B,00111100B
		DB      0001111B,11111111B,11111100B
		DB      0000111B,11111111B,11100000B
		DB      0000001B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE2:
        DB      0001000B,00000000B,00000000B
        DB      0001000B,00000000B,00000000B
		DB      0001111B,11111111B,11111100B
		DB      0001111B,11111111B,11111100B
		DB      0001111B,11111111B,11111000B
		DB      0001000B,00000000B,00001000B
		DB      0001000B,00000000B,00001000B
		DB      0000000B,00000000B,00000000B
		DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE3:
		DB      0000000B,00000000B,00000000B
        DB      0000001B,11111111B,11100000B
        DB      0000111B,11111111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001111B,00000000B,00111100B
        DB      0001000B,00000000B,00000100B
        DB      0001100B,00000000B,00001100B
        DB      0001111B,10000000B,01111100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111111B,11111000B
        DB      0000000B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE4:
        DB      0000000B,00000000B,00000000B
        DB      0000011B,11100011B,01110000B
        DB      0000111B,11110111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001000B,10001100B,01001100B
        DB      0001000B,00001100B,00000100B
        DB      0001000B,00001100B,00000100B
        DB      0001100B,00001111B,10011100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111011B,11111000B
        DB      0000011B,11110011B,11110000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
  

DELAY:
	MOV		R6,#70
DELAY1:
	MOV		R7,#70
DELAY2:
	DJNZ	R7,DELAY2
	DJNZ	R6,DELAY1
	RET

END