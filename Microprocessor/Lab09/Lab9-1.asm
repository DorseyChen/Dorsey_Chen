	ORG	00H
	JMP	INITIAL
	ORG	03H
	JMP	INTERRUPT
INITIAL:
	SETB	IT0                ;外部中斷P3.2設為edge trigger  	
	MOV	IE,#10000001B    	   ;interrupt enable EA=1,EX0=1	  	
	MOV	R4,#0              	   ;計算中斷次數用
	MOV	DPTR,#TABLE0          ;第一個字的table
WAIT:
	JMP	WAIT                   ;一個無限循環的空loop  	
INTERRUPT:                     ;中斷程式
	CJNE	R4,#5,J1           ;如果中斷次數＝5次
	MOV	DPTR,#TABLE1   			;放入第1個字的table
	INC	R4                     ;紀錄中斷次數+1 	
	JMP	LOOP                   ;跳去顯示字 	
J1:
	CJNE	R4,#10,J2          ;如果中斷次數＝10次
	MOV	DPTR,#TABLE2         	;放入第2個字的table		
	INC	R4               	   ;紀錄中斷次數+1 	
	JMP	LOOP                	;跳去顯示字	
J2:
	CJNE	R4,#15,J3          ;邏輯同上	
	MOV	DPTR,#TABLE3       
	INC	R4
	JMP	LOOP
J3:
	CJNE	R4,#20,J4          ;邏輯同上	
	MOV	DPTR,#TABLE4
	INC	R4
	JMP	LOOP
J4:
	CJNE	R4,#25,J5          ;邏輯同上	
	MOV	DPTR,#TABLE5
	INC	R4
	JMP	LOOP
J5:
	CJNE	R4,#30,BACK        ;邏輯同上	
	MOV	DPTR,#TABLE6       
	INC	R4
	JMP	LOOP
BACK:
	CJNE	R4,#35,FIRST        ;如果中斷次數＝35次
	MOV	DPTR,#TABLE0       		;放入第0個字的table
	MOV	R4,#0              		;中斷次數歸0		
	JMP	LOOP               		;跳去顯示字 	
FIRST:
	INC	R4                 
LOOP:				   	  		;顯示字      
	MOV	R0,#71            	 	;一個字有72*8bit組成
	MOV	R1,#24            		;顯示24次
NEXT_COLUMN:                    ;一次顯示3*8bit的燈 	
	CALL	READ_BYTE		
	MOV	P0,A
	CALL	READ_BYTE
	MOV	P2,A
	CALL	READ_BYTE
	MOV	P1,A
	CALL	DELAY             ;短暫的delay視覺暫留		
	DJNZ	R1,NEXT_COLUMN
	RETI                     ;一個字顯示完畢跳回WAIT		
                              ;等待下次interrupt  	

READ_BYTE:                    ;讀取table用
	MOV	A,R0			
	MOVC	A,@A+DPTR
	CPL	A
	DEC	R0
	RET
DELAY:
	MOV	R6,#70
DELAY1:
	MOV	R7,#70
DELAY2:
	DJNZ	R7,DELAY2
	DJNZ	R6,DELAY1
	RET

TABLE0:
		DB      0000000B,00000000B,00000000B
        DB      0000001B,11111111B,11100000B
        DB      0000111B,11111111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001111B,00000000B,00111100B
        DB      0001100B,00000000B,00001100B
        DB      0001100B,00000000B,00001100B
        DB      0001111B,10000000B,01111100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111111B,11111000B
        DB      0000000B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE1:
        DB      0000001B,11111100B,01100000B
		DB      0000111B,11111110B,01111000B
		DB      0001111B,11111111B,00001100B
		DB      0001111B,00000111B,00001100B
		DB      0001100B,00000011B,00001110B
		DB      0001100B,00000011B,00001110B
		DB      0001100B,00000011B,00001110B
		DB      0001110B,00000111B,00111100B
		DB      0001111B,11111111B,11111100B
		DB      0000111B,11111111B,11100000B
		DB      0000001B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE2:
        DB      0001000B,00000000B,00000000B
        DB      0001000B,00000000B,00000000B
		DB      0001111B,11111111B,11111100B
		DB      0001111B,11111111B,11111100B
		DB      0001111B,11111111B,11111000B
		DB      0001000B,00000000B,00001000B
		DB      0001000B,00000000B,00001000B
		DB      0000000B,00000000B,00000000B
		DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE3:
		DB      0000000B,00000000B,00000000B
        DB      0000001B,11111111B,11100000B
        DB      0000111B,11111111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001111B,00000000B,00111100B
        DB      0001000B,00000000B,00000100B
        DB      0001100B,00000000B,00001100B
        DB      0001111B,10000000B,01111100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111111B,11111000B
        DB      0000000B,11111111B,11000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
TABLE4:
        DB      0000000B,00000000B,00000000B
        DB      0000011B,11100011B,01110000B
        DB      0000111B,11110111B,11111000B
        DB      0001111B,11111111B,11111100B
        DB      0001000B,10001100B,01001100B
        DB      0001000B,00001100B,00000100B
        DB      0001000B,00001100B,00000100B
        DB      0001100B,00001111B,10011100B
        DB      0001111B,11111111B,11111100B
        DB      0000111B,11111011B,11111000B
        DB      0000011B,11110011B,11110000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B


TABLE5:
        DB      0000011B,11110000B,11110000B
		DB      0000111B,11111011B,11111000B
		DB      0001111B,11111011B,11111100B
		DB      0001100B,00001111B,10011100B
		DB      0001000B,00000100B,00000100B
		DB      0001000B,00000100B,00000100B
		DB      0001000B,10000100B,01001100B
		DB      0001111B,11000000B,11111100B
		DB      0000111B,11000000B,11111000B
		DB      0000011B,11000000B,01110000B
		DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B 
TABLE6:
        DB      0000000B,00000000B,00001100B
		DB      0000000B,00000000B,00111100B
		DB      0000000B,00000000B,01111100B
		DB      0000000B,00000011B,11101100B
		DB      0001111B,11111111B,11001100B
		DB      0001111B,11111110B,00001100B
		DB      0001111B,11111000B,00001100B
		DB      0000111B,00000000B,00001100B
		DB      0000000B,00000000B,00011100B
		DB      0000000B,00000000B,01111100B
		DB      0000000B,00000000B,01111100B
		DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B
        DB      0000000B,00000000B,00000000B

        
END